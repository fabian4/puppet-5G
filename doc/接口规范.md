# 硬核桃 5G 平台 接口规范

> 整理于《中国电信-中国联通 5G 消息业务平台行业客户接入接口技术规范 V1.0.4》

## 一、接口目录

1. [基础能力接口](#)



## 二、参数说明

### 1. url参数说明

| 序号 | 字段       | 数据类型 | 可选属性 | 描述                                                         |
| ---- | ---------- | -------- | -------- | ------------------------------------------------------------ |
| 1    | severRoot  | string   | 必选     | 服务器基础URL: hostname+port+base <br />Port和base path可选<br />例: example.com/exampleAPI |
| 2    | apiVersion | string   | 必选     | 客户端想使用的API版本号 <br />例: "v1"                       |
| 3    | chatbotId  | string   | 必选     | 行业消息的统一服务地址(Chatbot接 入号)，客户端可根据此地址将所有通 知集合展现。 |

### 2. 请求头参数

| 序号 | 字段           | 数据类型 | 可选属性                  | 描述                                                         |
| ---- | -------------- | -------- | ------------------------- | ------------------------------------------------------------ |
| 1    | authorization  | string   | 必选（除获取accessToken） | 调用接口凭证<br />例：accessToken TXlwdndOZG0yWTpjUml0dHMzM1dKRnBXRUdD |
| 2    | content-type   | string   | 必选                      | 发送的内容类型， 本协议取值 <br />application/json           |
| 3    | accept         | string   | 必选                      | 接受的数据类型类型，本协议取值<br /> application/json        |
| 4    | host           | string   | 必选                      | 请求服务器的域名/IP地址和端口号                              |
| 5    | date           | string   | 必选                      | 消息时间戳，默认标准Gmt表达方式 <br />例如：Date: Tue, 15 Nov 2019 08:12:31 GMT |
| 6    | content-length | long     | 可选                      | 内容长度                                                     |

### 3. 返回码说明

| 返回码      | 说明                                                   |
| ----------- | ------------------------------------------------------ |
| -1          | 系统繁忙                                               |
| -2          | 系统内部异常                                           |
| 0           | 请求成功                                               |
| 20002       | 参数异常                                               |
| 20003       | 请求异常                                               |
| 30001       | 超过日发送数量限制                                     |
| 30002       | 超过月发送数量限制                                     |
| 30003       | 超过每秒 发送数量限制                                  |
| 30004       | 超过年发送数量限制                                     |
| 30006       | 回调接口验证失败                                       |
| 30007       | 审核结果通知发送失败                                   |
| 30008       | chatbotId 与 senderAddress 不匹配                      |
| 40001       | 获取 accessToken 时 appKey 错误，或者 accessToken 无效 |
| 40002       | 不合法的凭证类型                                       |
| 40005       | 不合法的文件类型                                       |
| 40006       | 不合法的文件大小                                       |
| 40007       | 不合法的媒体素材 url                                   |
| 40008       | 不合法的消息类型                                       |
| 40011       | Chatbot 消息跟新失败                                   |
| 40014       | 不合法的 accessToken                                   |
| 40016       | 不合法的按钮个数                                       |
| 40017       | 不合法的按钮类型                                       |
| 40018       | 不合法的按钮名字长度                                   |
| 40019       | 不合法的按钮 KEY 长度                                  |
| 40020       | 不合法的按钮 URL 长度                                  |
| 40021       | 不合法的文本长度                                       |
| 40022       | 临时文件已过期                                         |
| 40040       | 文件数量长处限制                                       |
| 40052       | 不合法的按钮链接                                       |
| 41001       | 缺少 accessToken 参数                                  |
| 41002       | 缺少 appId 参数                                        |
| 41004       | 缺少 appKey 参数                                       |
| 41005       | 缺少多媒体文件数据                                     |
| 41006       | 缺少素材 url 参数                                      |
| 42001       | accessToken 超时                                       |
| 43001       | 需要GET请求                                            |
| 44001       | 多媒体文件为空                                         |
| 44002       | POST 的数据包为空                                      |
| 45001       | 接口调用超过限制                                       |
| 45010       | 回复时间超过限制                                       |
| 46001       | 不存在的用户                                           |
| 46002       | 临时用户不存在                                         |
| 46003       | 用户已被限制                                           |
| 47001       | 解析 JSON/XML 内容错误                                 |
| 47002       | 解析子菜单 JSON/XML 内容错误                           |
| 48001       | api 功能未授权                                         |
| 60001       | 不合法的内容                                           |
| 60002       | 需要订阅关系                                           |
| 60003       | 无效的消息类型                                         |
| 70001       | 消息体被管控                                           |
| 81000~83999 | 中国电信个性返回码                                     |
| 87000~89999 | 中国联通个性返回码                                     |

### 4. 接口频率限制说明

| 接口             | 每日限额 |
| ---------------- | -------- |
| 获取 accessToken | 2000     |
| 验收消息真实性   | 无上限   |
| 接收普通消息     | 无上限   |
| 接收时间推送     | 无上限   |
| 发送被动响应消息 | 无上限   |
| 发送主动客服消息 | 无上限   |

## 三、基础能力接口

### 1. 获取 accessToken

- **接口方向：** Chatbot→5G 消息业务平台 

- **请求方法：**`HTTPS POST `

- **请求URL**：**https://{serverRoot}/bot/{apiVersion}/{chatbotId}/accessToken**

- **接口说明：** accessToken是Chatbot帐号的全局唯一票据，Chatbot账号调用各接口时都需使用 accessToken。正常情况accessToken有效期为7200秒，重复获取将导致上次获取的 accessToken失效。由于获取accessToken的api调用次数非常有限，建议Chatbot全局存储与更 新accessToken，频繁刷新accessToken会导致api调用受限，影响自身业务。 Chatbot账号可以使用appId和appkey调用本接口来获取accessToken。appId和appkey可在 开发模式中获得。注意调用所有5G消息业务平台接口时均需使用https协议。 Chatbot首次获取accessToken成功，则认为Chatbot接入成功，Chatbot接入后，平台需要 进行回调url的验证，验证通过才认为该Chatbot已启用，为可用状态，否则该Chatbot不可用。

- **请求体**

  | 序号 | 字段   | 数据类型 | 可选属性 | 描述                      |
  | ---- | ------ | -------- | -------- | ------------------------- |
  | 1    | appId  | string   | 必选     | 第三方chatbot唯一凭证     |
  | 2    | appKey | string   | 必选     | 第三方chatbot唯一凭证密钥 |

  示例

  ```json
  { 
      "appId": "xxxxxxxx", 
      "appKey": "xxxxxxx" 
  }
  ```

- **返回体**

  | 序号 | 字段         | 数据类型 | 可选属性 | 描述                                        |
  | ---- | ------------ | -------- | -------- | ------------------------------------------- |
  | 1    | accessToken  | string   | 必选     | 获取到的凭证                                |
  | 2    | expires      | int      | 必选     | 凭证有效时间，单位：秒                      |
  | 3    | url          | string   | 必选     | 后续使用接口时调用的服务器地址              |
  | 4    | errorCode    | int      | 必选     | 状态码，0：成功<br />其它状态参见返回码说明 |
  | 5    | errorMessage | string   | 可选     | 错误描述                                    |

  示例

  ```json
  // 正确响应
  { 
      "accessToken": "xxxxxxxx", 
      "expires": 7200, 
      "errorCode":0, 
      "url": "xxxxxx" 
  }
  
  // 错误响应
  { 
      "errorCode": 40013, 
      "errorMessage": "not match rule" 
  }
  ```

  
